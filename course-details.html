<!DOCTYPE html>\n<html lang=\"ar\" dir=\"rtl\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>تفاصيل المساق | إتقان</title>\n  <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n  <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n  <link href=\"https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap\" rel=\"stylesheet\">\n  <link rel=\"stylesheet\" href=\"./assets/css/main.css\" />\n  <link rel=\"stylesheet\" href=\"./assets/css/components.css\" />\n</head>\n<body id=\"page-course-details\">\n  <header class=\"site-header\">\n    <div class=\"container header-inner\">\n      <a class=\"brand\" href=\"index.html\">\n        <img src=\"./assets/images/logo.png\" alt=\"شعار اتقان\" class=\"brand-logo\" />\n        <span class=\"brand-name\">إتقان</span>\n      </a>\n      <nav class=\"main-nav\">\n        <a href=\"courses.html\">المساقات</a>\n        <a href=\"dashboard.html\" data-protected=\"true\">لوحة التحكم</a>\n        <a href=\"login.html\">تسجيل الدخول</a>\n        <a href=\"signup.html\" class=\"btn primary\">حساب جديد</a>\n      </nav>\n    </div>\n  </header>\n\n  <main class=\"container\">\n    <div id=\"course\"></div>\n\n    <h2 class=\"mt-4\">المنهج</h2>\n    <div id=\"curriculum\" class=\"list\"></div>\n  </main>\n\n  <footer class=\"site-footer\">\n    <div class=\"container\">\n      <p>© 2026 إتقان - جميع الحقوق محفوظة</p>\n    </div>\n  </footer>\n\n  <script type=\"module\">\n    import { getCourseById } from './assets/js/api.js';\n    import { createLessonItem, escapeHtml } from './assets/js/ui.js';\n    import { initAuthGuards } from './assets/js/auth.js';\n\n    initAuthGuards();\n\n    const params = new URLSearchParams(window.location.search);\n    const id = params.get('id');\n    const courseEl = document.getElementById('course');\n    const curriculumEl = document.getElementById('curriculum');\n\n    getCourseById(id).then(course => {\n      if (!course) {\n        courseEl.innerHTML = `<div class=\\\"card\\\">لم يتم العثور على المساق</div>`;\n        return;\n      }\n      courseEl.innerHTML = `\n        <div class=\"card\">\n          <h1>${escapeHtml(course.title)}</h1>\n          <div class=\"meta mt-2\">المحاضر: ${escapeHtml(course.instructor)} | تقييم: ⭐ ${Number(course.rating).toFixed(1)} | السعر: ${Number(course.price).toFixed(2)} ج.م</div>\n          <p class=\"mt-3\">${escapeHtml(course.description)}</p>\n          <h3 class=\"mt-3\">أهداف التعلم</h3>\n          <ul>\n            ${(course.learning_objectives || []).map(o => `<li>${escapeHtml(o)}</li>`).join('')}\n          </ul>\n        </div>\n      `;\n\n      curriculumEl.classList.add('list', 'lessons');\n      (course.modules || []).forEach(m => {\n        const mTitle = document.createElement('h3');\n        mTitle.textContent = m.title;\n        curriculumEl.appendChild(mTitle);\n        (m.lessons || []).forEach(l => {\n          const item = createLessonItem(l);\n          curriculumEl.appendChild(item);\n        });\n      });\n    }).catch(err => {\n      courseEl.innerHTML = `<div class=\"card\">فشل تحميل بيانات المساق: ${err.message}</div>`;\n    });\n\n    // نموذج تقييم المساق\n    const rateCard = document.createElement('div');\n    rateCard.className = 'card mt-4';\n    rateCard.innerHTML = `\n      <h3>قيّم هذا المساق</h3>\n      <form id=\"rate-form\" class=\"form mt-2\">\n        <div class=\"form-row\">\n          <div>\n            <label class=\"label\" for=\"r-name\">اسمك</label>\n            <input id=\"r-name\" type=\"text\" class=\"input\" placeholder=\"اسمك\" required />\n          </div>\n          <div>\n            <label class=\"label\" for=\"r-stars\">التقييم</label>\n            <select id=\"r-stars\" class=\"input\" required>\n              <option value=\"5\">⭐⭐⭐⭐⭐ (5)</option>\n              <option value=\"4\">⭐⭐⭐⭐ (4)</option>\n              <option value=\"3\">⭐⭐⭐ (3)</option>\n              <option value=\"2\">⭐⭐ (2)</option>\n              <option value=\"1\">⭐ (1)</option>\n            </select>\n          </div>\n        </div>\n        <div>\n          <label class=\"label\" for=\"r-comment\">تعليقك</label>\n          <textarea id=\"r-comment\" class=\"textarea\" placeholder=\"رأيك في المساق\" required></textarea>\n        </div>\n        <button type=\"submit\" class=\"btn primary\">إرسال التقييم</button>\n        <div id=\"r-status\" class=\"alert success mt-2\" style=\"display:none\">تم إرسال التقييم بنجاح</div>\n      </form>\n    `;\n    document.querySelector('main.container').appendChild(rateCard);\n\n    document.getElementById('rate-form')?.addEventListener('submit', function(e){\n      e.preventDefault();\n      const name = document.getElementById('r-name').value.trim();\n      const stars = Number(document.getElementById('r-stars').value);\n      const comment = document.getElementById('r-comment').value.trim();\n      if (!name || !stars || !comment) return;\n      const key = 'itqan_ratings_'+id;\n      const ratings = JSON.parse(localStorage.getItem(key) || '[]');\n      ratings.push({ id: 'r_'+Date.now(), name, stars, comment });\n      localStorage.setItem(key, JSON.stringify(ratings));\n      const status = document.getElementById('r-status');\n      status.style.display = 'block';\n      this.reset();\n      setTimeout(()=>{ status.style.display = 'none'; }, 3000);\n    });\n  </script>\n</body>\n</html>\n