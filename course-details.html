<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ù‚ | Ø¥ØªÙ‚Ø§Ù†</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/css/main.css" />
  <link rel="stylesheet" href="./assets/css/components.css" />
</head>
<body id="page-course-details">
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <img src="./assets/images/logo.png" alt="Ø´Ø¹Ø§Ø± Ø§ØªÙ‚Ø§Ù†" class="brand-logo" />
        <span class="brand-name">Ø¥ØªÙ‚Ø§Ù†</span>
      </a>
      <nav class="main-nav">
        <a href="courses.html">Ø§Ù„Ù…Ø³Ø§Ù‚Ø§Øª</a>
        <a href="dashboard.html" data-protected="true">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
        <a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        <a href="signup.html" class="btn primary">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
        <button class="icon-btn" id="toggle-theme" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">ğŸŒ™</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <div id="course"></div>

    <h2 class="mt-4">Ø§Ù„Ù…Ù†Ù‡Ø¬</h2>
    <div id="curriculum" class="list"></div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Â© 2026 Ø¥ØªÙ‚Ø§Ù† - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
    </div>
  </footer>

  <script type="module">
    import { getCourseById } from './assets/js/api.js';
    import { createLessonItem, escapeHtml } from './assets/js/ui.js';
    import { initAuthGuards, restoreThemePreference } from './assets/js/auth.js';

    restoreThemePreference();
    initAuthGuards();

    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const courseEl = document.getElementById('course');
    const curriculumEl = document.getElementById('curriculum');

    getCourseById(id).then(course => {
      if (!course) {
        courseEl.innerHTML = `<div class="card">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ù‚</div>`;
        return;
      }
      courseEl.innerHTML = `
        <div class="card">
          <h1>${escapeHtml(course.title)}</h1>
          <div class="meta mt-2">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±: ${escapeHtml(course.instructor)} | ØªÙ‚ÙŠÙŠÙ…: â­ ${Number(course.rating).toFixed(1)} | Ø§Ù„Ø³Ø¹Ø±: ${Number(course.price).toFixed(2)} Ø¬.Ù…</div>
          <p class="mt-3">${escapeHtml(course.description)}</p>
          <h3 class="mt-3">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªØ¹Ù„Ù…</h3>
          <ul>
            ${(course.learning_objectives || []).map(o => `<li>${escapeHtml(o)}</li>`).join('')}
          </ul>
        </div>
      `;

      // Ø§Ù„Ù…Ù†Ù‡Ø¬
      curriculumEl.classList.add('list', 'lessons');
      (course.modules || []).forEach(m => {
        const mTitle = document.createElement('h3');
        mTitle.textContent = m.title;
        curriculumEl.appendChild(mTitle);
        (m.lessons || []).forEach(l => {
          const item = createLessonItem(l);
          curriculumEl.appendChild(item);
        });
      });
    }).catch(err => {
      courseEl.innerHTML = `<div class="card">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ù‚: ${err.message}</div>`;
    });

    const btn = document.getElementById('toggle-theme');
    btn?.addEventListener('click', () => {
      const isLight = document.body.classList.toggle('light');
      localStorage.setItem('itqan_theme', isLight ? 'light' : 'dark');
    });
  </script>
</body>
</html>