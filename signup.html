<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุญุณุงุจ ุฌุฏูุฏ | ุฅุชูุงู</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/css/main.css" />
  <link rel="stylesheet" href="./assets/css/components.css" />
</head>
<body id="page-signup">
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <img src="./assets/images/logo.png" alt="ุดุนุงุฑ ุงุชูุงู" class="brand-logo" />
        <span class="brand-name">ุฅุชูุงู</span>
      </a>
      <nav class="main-nav">
        <a href="courses.html">ุงููุณุงูุงุช</a>
        <a href="dashboard.html" data-protected="true">ููุญุฉ ุงูุชุญูู</a>
        <a href="login.html">ุชุณุฌูู ุงูุฏุฎูู</a>
        <a href="signup.html" class="btn primary active">ุญุณุงุจ ุฌุฏูุฏ</a>
        <button class="icon-btn" id="toggle-theme" title="ุงููุถุน ุงููููู">๐</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</h1>
    <div class="card mt-2" style="max-width: 520px;">
      <form id="signup-form">
        <label class="form-label">ุงูุงุณู ุงููุงูู</label>
        <input type="text" id="name" class="form-input input" placeholder="ุงูุงุณู" required />
        <label class="form-label mt-2">ุงุฎุชุฑ ุงูุฏูุฑ</label>
        <div id="role-group" class="segmented">
          <input type="radio" id="role-student" name="role" value="student" />
          <label for="role-student">ุทุงูุจ</label>
          <input type="radio" id="role-parent" name="role" value="parent" />
          <label for="role-parent">ููู ุฃูุฑ</label>
          <input type="radio" id="role-teacher" name="role" value="teacher" />
          <label for="role-teacher">ูุนูู</label>
        </div>
        <div id="field-nationalId" class="mt-2" style="display:none">
          <label class="form-label">ุงูุฑูู ุงููููู (ููุทูุงุจ)</label>
          <input type="text" id="nationalId" class="form-input input" placeholder="ูุซุงู: 30201234567890" />
        </div>
        <div id="field-phone" class="mt-2" style="display:none">
           <label class="form-label">ุฑูู ุงูููุจุงูู</label>
           <input type="tel" id="phone" class="form-input input" placeholder="01012345678" />
         </div>
        <label class="form-label mt-2">ูููุฉ ุงููุฑูุฑ</label>
        <div class="password-field">
          <input type="password" id="password" class="form-input input" placeholder="โขโขโขโขโขโขโขโข" required />
          <button type="button" class="toggle-pass" id="toggle-pass" aria-label="ุฅุธูุงุฑ/ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ">๐</button>
        </div>
        <button type="submit" class="btn primary mt-3" style="width: 100%">ุฅูุดุงุก ุงูุญุณุงุจ</button>
      </form>
      <div id="error" class="alert danger mt-2" style="display:none"></div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>ยฉ 2026 ุฅุชูุงู - ุฌููุน ุงูุญููู ูุญููุธุฉ</p>
    </div>
  </footer>

  <script type="module">
    import { signup, restoreThemePreference, initAuthGuards, routeToDashboardByRole } from './assets/js/auth.js';
    import { initFirebase } from './assets/js/firebase.js';

    restoreThemePreference();
    initAuthGuards();
    initFirebase();

    const form = document.getElementById('signup-form');
    const errorEl = document.getElementById('error');
    const btn = document.getElementById('toggle-theme');
    const roleGroup = document.getElementById('role-group');
    const fieldNationalId = document.getElementById('field-nationalId');
    const fieldPhone = document.getElementById('field-phone');

    const getRole = () => {
      const checked = document.querySelector('input[name="role"]:checked');
      return checked ? checked.value : '';
    };

    roleGroup.addEventListener('change', () => {
      const role = getRole();
      if (role === 'student') {
        fieldNationalId.style.display = 'block';
        fieldPhone.style.display = 'none';
      } else if (role) {
        fieldNationalId.style.display = 'none';
        fieldPhone.style.display = 'block';
      }
    });

    document.getElementById('toggle-pass')?.addEventListener('click', () => {
      const inp = document.getElementById('password');
      inp.type = inp.type === 'password' ? 'text' : 'password';
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorEl.style.display = 'none';
      const name = document.getElementById('name').value.trim();
      const role = getRole();
      const nationalId = document.getElementById('nationalId').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const password = document.getElementById('password').value;
      try {
        const user = await signup({ name, role, nationalId, phone, password });
        routeToDashboardByRole(user);
      } catch (err) {
        errorEl.textContent = err.message;
        errorEl.style.display = 'block';
      }
    });

    btn?.addEventListener('click', () => {
      const isLight = document.body.classList.toggle('light');
      localStorage.setItem('itqan_theme', isLight ? 'light' : 'dark');
    });
  </script>
</body>
</html>